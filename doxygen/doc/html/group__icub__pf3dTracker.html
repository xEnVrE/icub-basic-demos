<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.17"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>icub-basic-demos: pf3dTracker</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">icub-basic-demos
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.17 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">pf3dTracker</div>  </div>
</div><!--header-->
<div class="contents">
<p><br  />
</p>
<p>A robust and real-time 3D ball tracker.</p>
<p>Copyright (C) 2009 RobotCub Consortium</p>
<p>Author: Matteo Taiana, <a href="http://users.isr.ist.utl.pt/~mtaiana/">homepage</a>.</p>
<p>CopyPolicy: Released under the terms of the GNU GPL v2.0.</p>
<h1><a class="anchor" id="intro_sec"></a>
Description</h1>
<p>This module implements a model-based object tracker: it estimates the 3D position of a ball given a sequence of images. One estimate is computed for each input image. The tracker outputs a flag that is set to 1 when the module is confident that it is tracking a ball, when the flag is set to 0 the tracker still computes a 3D estimate, but that is meaningless. After 5 frames with confidence under the threshold, the tracker estimate is reset. The module is meant to work together with <a class="el" href="group__icub__pf3dBottomup.html">pf3dBottomup</a>, which is a 3D ball detector, but can also work on its own.</p>
<p><b>For an explanation on how to configure the tracker and bottom up modules, how to connect them, how to run them through the application manager, etc., please have a look at <a href="http://mediawiki.isr.ist.utl.pt/wiki/3D_ball_tracker">this page</a>.</b></p>
<p><b>The algorithm is described in the paper: "Tracking objects with generic calibrated sensors: an algorithm based on color and 3D shape features", please cite it if you use the tracker in your research.</b></p>
<p>You can watch a video of the tracker in action <a href="http://www.youtube.com/watch?v=Xp8qUhfMzhU">here</a>.</p>
<h1><a class="anchor" id="lib_sec"></a>
Libraries</h1>
<ul>
<li>YARP libraries.</li>
<li>OpenCv</li>
</ul>
<h1><a class="anchor" id="parameters_sec"></a>
Parameters</h1>
<p>Configuration is done through an initialization file (See for instance icub-main/app/pf3dTracker/conf/pf3dTracker.ini) Here is an example, with comments: </p><div class="fragment"><div class="line"><span class="preprocessor">####################################</span></div>
<div class="line"><span class="preprocessor">#configuration file for pf3dTracker#</span></div>
<div class="line"><span class="preprocessor">####################################</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#############</span></div>
<div class="line"><span class="preprocessor">#module name#</span></div>
<div class="line"><span class="preprocessor">#############</span></div>
<div class="line">name                        /pf3dTracker</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#############################</span></div>
<div class="line"><span class="preprocessor">#parameters of the algorithm#</span></div>
<div class="line"><span class="preprocessor">#############################</span></div>
<div class="line">nParticles                  900</div>
<div class="line"><span class="preprocessor">#nParticles                 number of particles used</span></div>
<div class="line">accelStDev                  30</div>
<div class="line"><span class="preprocessor">#accelStDev                 standard deviation of the acceleration noise</span></div>
<div class="line">insideOutsideDiffWeight     1.5</div>
<div class="line">#insideOutsideDiffWeight    inside-outside difference weight <span class="keywordflow">for</span> the likelihood <span class="keyword">function</span></div>
<div class="line">colorTransfPolicy           1</div>
<div class="line"><span class="preprocessor">#colorTransfPolicy          [0=transform the whole image | 1=only transform the pixels you need]</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#########################</span></div>
<div class="line"><span class="preprocessor">#port names and function#</span></div>
<div class="line"><span class="preprocessor">#########################</span></div>
<div class="line">inputVideoPort              /pf3dTracker/video:i</div>
<div class="line"><span class="preprocessor">#inputVideoPort             receives images from the grabber or the rectifying program.</span></div>
<div class="line">outputVideoPort             /pf3dTracker/video:o</div>
<div class="line"><span class="preprocessor">#outputVideoPort            produces images in which the contour of the estimated ball is highlighted.</span></div>
<div class="line">outputDataPort              /pf3dTracker/data:o</div>
<div class="line"><span class="preprocessor">#outputDataPort             produces a stream of data in the format: X, Y, Z [meters], likelihood, U, V [pixels], seeing_object.</span></div>
<div class="line">inputParticlePort           /pf3dTracker/particles:i</div>
<div class="line"><span class="preprocessor">#inputParticlePort          receives hypotheses on the position of the ball from the bottom up module</span></div>
<div class="line">outputParticlePort          /pf3dTracker/particles:o</div>
<div class="line"><span class="preprocessor">#outputParticlePort         produces data for the plotter. it is usually not active for performance reasons.</span></div>
<div class="line">outputAttentionPort         /pf3dTracker/attention:o</div>
<div class="line"><span class="preprocessor">#outputAttentionPort        produces data for the attention system, in terms of a peak of saliency.</span></div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#################################</span></div>
<div class="line"><span class="preprocessor">#projection model and parameters#</span></div>
<div class="line"><span class="preprocessor">#################################</span></div>
<div class="line"><span class="preprocessor">#projectionModel, only the perspective one was implemented so far.</span></div>
<div class="line">projectionModel             perspective</div>
<div class="line"> </div>
<div class="line">cameraContext  cameraCalibration</div>
<div class="line">cameraFile     icubEyes.ini</div>
<div class="line">cameraGroup    CAMERA_CALIBRATION_LEFT</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#######################</span></div>
<div class="line"><span class="preprocessor">#tracked object models#</span></div>
<div class="line"><span class="preprocessor">#######################</span></div>
<div class="line"><span class="preprocessor">#trackedObjectType, only sphere was implemented so far.</span></div>
<div class="line">trackedObjectType           sphere</div>
<div class="line">trackedObjectColorTemplate  models/red_smiley_2009_07_02.bmp</div>
<div class="line">trackedObjectShapeTemplate  models/initial_ball_points_smiley_31mm_20percent.csv</div>
<div class="line"> </div>
<div class="line">motionModelMatrix           models/motion_model_matrix.csv</div>
<div class="line">trackedObjectTemp           current_histogram.csv</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#######################</span></div>
<div class="line"><span class="preprocessor">#initialization method#</span></div>
<div class="line"><span class="preprocessor">#######################</span></div>
<div class="line"><span class="preprocessor">#initialization method, only 3dEstimate was implemented so far.</span></div>
<div class="line">initializationMethod        3dEstimate</div>
<div class="line"><span class="preprocessor">#initial position [meters]</span></div>
<div class="line">initialX                       0</div>
<div class="line">initialY                       0</div>
<div class="line">initialZ                       0.5  </div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">####################</span></div>
<div class="line"><span class="preprocessor">#visualization mode#</span></div>
<div class="line"><span class="preprocessor">####################</span></div>
<div class="line"><span class="preprocessor">#circleVisualizationMode [0=inner and outer circle | 1=one circle with the correct radius]</span></div>
<div class="line"><span class="preprocessor">#default 0. only applies to the sphere.</span></div>
<div class="line">circleVisualizationMode 1</div>
<div class="line"> </div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#################################</span></div>
<div class="line"><span class="preprocessor">#likelihood and reset condition #</span></div>
<div class="line"><span class="preprocessor">#################################</span></div>
<div class="line"><span class="preprocessor">#the tracker produces a value of likelihood at each time step.</span></div>
<div class="line"><span class="preprocessor">#this value can be used to infer if the object it is tracking is the correct one.</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor">#if likelihood&lt;=this value for 5 consecutive frames, the tracker</span></div>
<div class="line"><span class="preprocessor">#assumes it&#39;s not seeing the right object and is reinitialized.</span></div>
<div class="line"><span class="preprocessor">#</span></div>
<div class="line"><span class="preprocessor">likelihoodThreshold         0.005</span></div>
</div><!-- fragment --><h1><a class="anchor" id="portsa_sec"></a>
Ports Accessed</h1>
<p>The tracker need to be connected to a port that streams images, at the very least, in order to work.</p>
<h1><a class="anchor" id="portsc_sec"></a>
Ports Created</h1>
<ul>
<li>/pf3dTracker/video:i receives the image stream given which the ball has to be tracked.</li>
<li>/pf3dTracker/video:o produces images in which the contour of the estimated ball is highlighted. When the tracker is confident that it's tracking a ball, it draws the contour in green, when it is not confident (it's looking for a ball, but does not yet have a good estimate), it draws the contour in yellow.</li>
<li>/pf3dTracker/data:o produces a stream of data in the format: X, Y, Z [meters], likelihood, U, V [pixels], seeing_object. <br  />
 X, Y and Z are the estimated coordinates of the tracked ball in the eye reference frame (they can be transformed to the root reference frame by module eye2RootFrameTransformer. The likelihood value indicates how confident the tracker is that the object it's tracking is the right ball (the lower the likelihood, the lower the confidence, but beware that even a perfect match will result in a value pretty far from 1). U and V are the estimated coordinates of the centre of the ball in the image plane, U is horizontal and V vertical, the origin is on the top left corner of the image. Seeing_object is a flag, it is set 1 when the likelihood is higher than a threshold specified in the initialization file, it is set to 0 otherwise. When the tracker experiences 5 consecutive images with seeing_object==0, the estimate is reset. This prevents the tracker from getting stuck on an unlikely target.</li>
<li>/pf3dTracker/particles:i receives hypotheses on 3D poses of a ball, normally produced by the <a class="el" href="group__icub__pf3dBottomup.html">pf3dBottomup</a> detection module. If the tracker does not receive anything on this port, it behaves normally, i.e., it needs more time to find a ball and start tracking it, after initialization.</li>
<li>/pf3dTracker/particles:o produces data for the plotter. it is usually not active for performance reasons.</li>
<li>/pf3dTracker/attention:o produces data for the attention system, in terms of a peak of saliency.</li>
</ul>
<h1><a class="anchor" id="in_files_sec"></a>
Input Data Files</h1>
<p>The tracker requires three input files: an image file used to build the colour model of the tracked ball, a file defining the motion model applied to the estimate of the ball between frames, and a shape model for the ball, defining its size and the distance between inner and outer contours (see the paper cited in the description section). For more detail on these files, please have a look at the parameters section.</p>
<h1><a class="anchor" id="out_data_sec"></a>
Output Data Files</h1>
<p>The module produces one output file that is only useful for debugging (current_histogram.csv) and can be configured to save the images it produces to files, but this is not recommended: use yarpdatadumper instead.</p>
<h1><a class="anchor" id="tested_os_sec"></a>
Tested OS</h1>
<p>Ubuntu Linux, Windows</p>
<dl class="section author"><dt>Author</dt><dd>Matteo Taiana, <a href="http://users.isr.ist.utl.pt/~mtaiana/">homepage</a>. </dd></dl>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.17
</small></address>
</body>
</html>
